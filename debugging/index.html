
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Debugging &#8212; ARDEP  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="UDS Sample (Legacy)" href="../samples/uds_legacy/README.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="debugging">
<span id="id1"></span><h1>Debugging<a class="headerlink" href="#debugging" title="Permalink to this heading">¶</a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#ardep-v2-0-0-and-later" id="id2">Ardep v2.0.0 and later</a></p>
<ul>
<li><p><a class="reference internal" href="#firmware-updates" id="id3">Firmware Updates</a></p></li>
<li><p><a class="reference internal" href="#obtaining-firmware-images" id="id4">Obtaining Firmware Images</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#ardep-v1-0-0" id="id5">Ardep v1.0.0</a></p>
<ul>
<li><p><a class="reference internal" href="#connect-a-debug-probe" id="id6">Connect a debug probe</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="ardep-v2-0-0-and-later">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Ardep v2.0.0 and later</a><a class="headerlink" href="#ardep-v2-0-0-and-later" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The gdb version provided by the zephyr-sdk does not work correctly with the <a class="reference external" href="https://black-magic.org/index.html">Black Magic Probe</a>.</p>
<p>Therefore the <code class="docutils literal notranslate"><span class="pre">west</span> <span class="pre">debug</span></code> command will not work.</p>
<p>Instead, use the <code class="docutils literal notranslate"><span class="pre">gdb-multiarch</span></code> or <code class="docutils literal notranslate"><span class="pre">arm-none-eabi-gdb</span></code> you installed in the <a class="reference internal" href="../getting_started/index.html#getting-started"><span class="std std-ref">Getting Started</span></a> guide.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Depending on you system, you might have <code class="docutils literal notranslate"><span class="pre">gdb-multiarch</span></code> or <code class="docutils literal notranslate"><span class="pre">arm-none-eabi-gdb</span></code> installed. Both work the same way. Just substitute the command name accordingly.</p>
</div>
<p>Ardep v2.0.0 and later come with an on-board debugger (OBD) based on the <a class="reference external" href="https://black-magic.org/index.html">Black Magic Probe (BMP)</a>  project.</p>
<p>This allows for easy debugging and flashing without the need for an external debug probe.</p>
<p>For an overview of the host interface, see <a class="reference internal" href="../boards/mercedes/ardep/doc/on_board_debugger/index.html#on-board-debugger"><span class="std std-ref">On-Board Debugger (OBD)</span></a>.</p>
<p>After you connected the debugger to the host via USB-C, start the debugger session with <code class="docutils literal notranslate"><span class="pre">arm-none-eabi-gdb</span> <span class="pre">/path/to/build/zephyr/zephyr.elf</span></code> and run the following instructions to correctly configure the debugger:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>target<span class="w"> </span>extended-remote<span class="w"> </span>/dev/ttyACM0

monitor<span class="w"> </span>auto_scan

attach<span class="w"> </span><span class="m">1</span>
</pre></div>
</div>
<p>Replace <code class="docutils literal notranslate"><span class="pre">/dev/ttyACM0</span></code> with the correct device node for your system.</p>
<p>A gdbinit script file is included in the root of the repository as <code class="docutils literal notranslate"><span class="pre">debug.gdbinit</span></code>. You can use it to automate the startup process with <code class="docutils literal notranslate"><span class="pre">arm-none-eabi-gdb</span> <span class="pre">-x</span> <span class="pre">debug.gdbinit</span> <span class="pre">/path/to/build/zephyr/zephyr.elf</span></code>.</p>
<p>See the <a class="reference external" href="https://black-magic.org/usage/gdb-commands.html">BMP Guide</a> for more information.</p>
</div></blockquote>
<section id="firmware-updates">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">Firmware Updates</a><a class="headerlink" href="#firmware-updates" title="Permalink to this heading">¶</a></h3>
<p>The Black Magic Probe firmware can be updated using the dedicated <code class="docutils literal notranslate"><span class="pre">bmputil-cli</span></code> utility or an external programmer.</p>
<section id="bmputil-cli">
<h4>bmputil-cli<a class="headerlink" href="#bmputil-cli" title="Permalink to this heading">¶</a></h4>
<ul>
<li><p>Install the utility following the <a class="reference external" href="https://black-magic.org/upgrade.html">official upgrade guide</a>.</p></li>
<li><p>With the debugger connected, inspect the current firmware revision:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>bmputil-cli<span class="w"> </span>probe<span class="w"> </span>info
</pre></div>
</div>
</li>
<li><p>Upgrade to the latest release:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>bmputil-cli<span class="w"> </span>probe<span class="w"> </span>update
</pre></div>
</div>
<p>Select <code class="docutils literal notranslate"><span class="pre">Black</span> <span class="pre">Magic</span> <span class="pre">Debug</span> <span class="pre">for</span> <span class="pre">BMP</span> <span class="pre">(ST</span> <span class="pre">and</span> <span class="pre">ST-clones</span> <span class="pre">targets)</span></code> when prompted for the firmware variant and <code class="docutils literal notranslate"><span class="pre">Flash</span> <span class="pre">to</span> <span class="pre">probe</span></code> for the action.</p>
</li>
<li><p>Repeat <code class="docutils literal notranslate"><span class="pre">bmputil-cli</span> <span class="pre">probe</span> <span class="pre">info</span></code> to confirm that the new firmware version is active.</p></li>
<li><p>To flash a specific release or custom build, pass the firmware binary path to <code class="docutils literal notranslate"><span class="pre">bmputil-cli</span> <span class="pre">probe</span> <span class="pre">update</span></code>.</p></li>
</ul>
</section>
<section id="manual-update-via-external-debug-probe">
<h4>Manual Update via External Debug Probe<a class="headerlink" href="#manual-update-via-external-debug-probe" title="Permalink to this heading">¶</a></h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This method also supports flashing the bootloader.</p>
</div>
<p>A Tag-Connect footprint labeled <code class="docutils literal notranslate"><span class="pre">DEBUGGER</span></code> is located on the back of the board for in-circuit programming with an external debugger.
Use any SWD-compatible debugger to program the binaries at the following offsets:</p>
<blockquote>
<div><ul class="simple">
<li><p>Firmware image at <code class="docutils literal notranslate"><span class="pre">0x08002000</span></code></p></li>
<li><p>Bootloader image at <code class="docutils literal notranslate"><span class="pre">0x08000000</span></code></p></li>
</ul>
</div></blockquote>
</section>
</section>
<section id="obtaining-firmware-images">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Obtaining Firmware Images</a><a class="headerlink" href="#obtaining-firmware-images" title="Permalink to this heading">¶</a></h3>
<section id="pre-built-binaries">
<h4>Pre-built Binaries<a class="headerlink" href="#pre-built-binaries" title="Permalink to this heading">¶</a></h4>
<p>Download the latest release from the <a class="reference external" href="https://github.com/blackmagic-debug/blackmagic/releases">Black Magic Probe GitHub repository</a>.</p>
<p>This board requires the release named <code class="docutils literal notranslate"><span class="pre">blackmagic-native-st-clones</span></code>.</p>
</section>
<section id="build-from-source">
<h4>Build from Source<a class="headerlink" href="#build-from-source" title="Permalink to this heading">¶</a></h4>
<p>Follow the upstream <a class="reference external" href="https://github.com/blackmagic-debug/blackmagic/blob/main/README.md#getting-started">getting started guide</a> to build the probe firmware with the following changes:</p>
<blockquote>
<div><ul class="simple">
<li><p>Configure the build with the <code class="docutils literal notranslate"><span class="pre">stlink.ini</span></code> cross-file</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">-Dbmd_bootloader=true</span></code> to the build setup step to enable building of the bootloader</p></li>
</ul>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/blackmagic-debug/blackmagic.git
<span class="nb">cd</span><span class="w"> </span>blackmagic
meson<span class="w"> </span>setup<span class="w"> </span>build<span class="w"> </span>--cross-file<span class="o">=</span>cross-file/stlink.ini<span class="w"> </span>-Dbmd_bootloader<span class="o">=</span><span class="nb">true</span>
meson<span class="w"> </span>compile<span class="w"> </span>-C<span class="w"> </span>build
meson<span class="w"> </span>compile<span class="w"> </span>-C<span class="w"> </span>build<span class="w"> </span>boot-bin
</pre></div>
</div>
</div></blockquote>
</section>
</section>
</section>
<section id="ardep-v1-0-0">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Ardep v1.0.0</a><a class="headerlink" href="#ardep-v1-0-0" title="Permalink to this heading">¶</a></h2>
<p>The following section describes how to use an on chip debugger with ardep.</p>
<section id="connect-a-debug-probe">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Connect a debug probe</a><a class="headerlink" href="#connect-a-debug-probe" title="Permalink to this heading">¶</a></h3>
<p>Connect a debug probe to the SWD pins of the ARDEP board.</p>
<a class="reference internal image-reference" href="../_images/swd_pinout.png"><img alt="measurement" src="../_images/swd_pinout.png" style="width: 600px;" /></a>
<p>Pin one should only be connected to a voltage measuring pin (if required) not to power the board.</p>
<p>For example for an ST-Link V2 you can connect the following pins:</p>
<ul class="simple">
<li><p>SWDIO to pin 2</p></li>
<li><p>SWCLK to pin 4</p></li>
<li><p>GND to pin 5</p></li>
<li><p>RST to pin 3</p></li>
</ul>
<section id="flash-using-openocd">
<h4>Flash using openocd<a class="headerlink" href="#flash-using-openocd" title="Permalink to this heading">¶</a></h4>
<p>To flash the board using openocd you can use the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>west<span class="w"> </span>flash<span class="w"> </span>--runner<span class="w"> </span>openocd
</pre></div>
</div>
</section>
<section id="debug-using-openocd">
<h4>Debug using openocd<a class="headerlink" href="#debug-using-openocd" title="Permalink to this heading">¶</a></h4>
<p>To debug the board using openocd you can use the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>west<span class="w"> </span>debug<span class="w"> </span>--runner<span class="w"> </span>openocd
</pre></div>
</div>
</section>
<section id="flash-and-debug-using-jlink">
<h4>Flash and debug using JLINK<a class="headerlink" href="#flash-and-debug-using-jlink" title="Permalink to this heading">¶</a></h4>
<p>Use the sample commands as above, but replace <cite>openocd</cite> with <cite>jlink</cite>.</p>
</section>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">ARDEP</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bootloader/index.html">Bootloader</a></li>
<li class="toctree-l1"><a class="reference internal" href="../firmware_loader/index.html">UDS Firmware Loader</a></li>
<li class="toctree-l1"><a class="reference internal" href="../console/index.html">Console Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="../error_handling/index.html">Error Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lib/index.html">Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scripts/ardep.html">ARDEP Command</a></li>
<li class="toctree-l1"><a class="reference internal" href="../boards/mercedes/ardep/doc/index.html">ARDEP Board</a></li>
<li class="toctree-l1"><a class="reference internal" href="../boards/shields/hv_shield/doc/index.html">ARDEP HV Shield</a></li>
<li class="toctree-l1"><a class="reference internal" href="../boards/shields/power_io_shield/doc/index.html">ARDEP Power IO Shield</a></li>
<li class="toctree-l1"><a class="reference internal" href="../samples/index.html">Samples and Demos</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Debugging</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#ardep-v2-0-0-and-later">Ardep v2.0.0 and later</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ardep-v1-0-0">Ardep v1.0.0</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="../samples/uds_legacy/README.html" title="previous chapter">UDS Sample (Legacy)</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Frickly Systems GmbH.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 6.2.1</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../_sources/debugging/index.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>