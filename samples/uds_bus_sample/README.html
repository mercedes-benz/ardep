
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>UDS Bus Sample &#8212; ARDEP  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="UDS Sample (Legacy)" href="../uds_legacy/README.html" />
    <link rel="prev" title="UDS Sample" href="../uds/README.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="uds-bus-sample">
<span id="id1"></span><h1>UDS Bus Sample<a class="headerlink" href="#uds-bus-sample" title="Permalink to this heading">¶</a></h1>
<p>This sample demonstrates multiple UDS clients connected on a single CAN bus.
They use different physical addresses for communication.</p>
<p>This sample also demonstrates how the UDS clients can communicate to each other on the CAN bus via a small, custom protocol that lets each client “sign” a byte in a CAN message by each client.
For this, each client contains a <em>worker</em> functionality that listens for CAN frames on a specifig address (configurable via data identifier <code class="docutils literal notranslate"><span class="pre">0x1100</span></code> (2 bytes with little endian)) and responds (with the appended signature byte) on another configurable address (data identifier <code class="docutils literal notranslate"><span class="pre">0x1101</span></code>).
Each client also contains an <em>controller</em> which uses a routine (routine id <code class="docutils literal notranslate"><span class="pre">0x0000</span></code>) that is responsible for sending a first CAN frame to the first client in the chain, and then receiving the final response from the last client in the chain.</p>
<p>The controller uses a fixed send address of 0x001 and a fixed receive address of 0x000.</p>
<section id="building-the-sample">
<h2>Building the Sample<a class="headerlink" href="#building-the-sample" title="Permalink to this heading">¶</a></h2>
<p>The sample should be built using sysbuild as the UDS addresses should be configured the same for the bootloader and application via the sysbuild configuration <code class="docutils literal notranslate"><span class="pre">SB_CONFIG_UDS_BASE_ADDR</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>west<span class="w"> </span>build<span class="w"> </span>-b<span class="w"> </span>ardep<span class="w"> </span>samples/uds_bus_sample<span class="w"> </span>--sysbuild<span class="w"> </span>--<span class="w"> </span>-DSB_CONFIG_UDS_BASE_ADDR<span class="o">=</span><span class="m">0</span>
</pre></div>
</div>
<p>Each ARDEP UDS client should be built with a different base address, all in a continuous range.
For example, for 3 clients, the first client should be built with <code class="docutils literal notranslate"><span class="pre">SB_CONFIG_UDS_BASE_ADDR=0</span></code>, the second with <code class="docutils literal notranslate"><span class="pre">SB_CONFIG_UDS_BASE_ADDR=1</span></code>, and the third with <code class="docutils literal notranslate"><span class="pre">SB_CONFIG_UDS_BASE_ADDR=2</span></code>.</p>
<p>Note that if you need to set the pristine flag, you need to put it before the <code class="docutils literal notranslate"><span class="pre">--</span></code> separator.</p>
</section>
<section id="can-ids">
<h2>CAN IDs<a class="headerlink" href="#can-ids" title="Permalink to this heading">¶</a></h2>
<p>By using sysbuild, the CAN IDs are automatically configured based on the UDS base address. (see <code class="docutils literal notranslate"><span class="pre">sysbuild.cmake</span></code> in the sample directory for details).
The resulting CAN IDs are:</p>
<ul class="simple">
<li><p>UDS request ID: <code class="docutils literal notranslate"><span class="pre">0x7E0</span></code> + base address</p></li>
<li><p>UDS response ID: <code class="docutils literal notranslate"><span class="pre">0x7E8</span></code> + base address</p></li>
<li><p>CAN Logging ID: <code class="docutils literal notranslate"><span class="pre">0x100</span></code> + base address</p></li>
</ul>
</section>
<section id="running-the-sample">
<h2>Running the Sample<a class="headerlink" href="#running-the-sample" title="Permalink to this heading">¶</a></h2>
<p>To run the sample, first flash all ARDEPs with the build firmwares (each a different one as described above).
Then, run the client script:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>client.py<span class="w"> </span>--can<span class="w"> </span>can0
</pre></div>
</div>
<p>If you wish to upgrade the firmwares before running the sample, use the <code class="docutils literal notranslate"><span class="pre">--upgrade</span></code> option, together with a set maximum count <code class="docutils literal notranslate"><span class="pre">--count</span></code> of clients to upgrade, a board name <code class="docutils literal notranslate"><span class="pre">--board</span></code>, and optionally <code class="docutils literal notranslate"><span class="pre">--pristine</span></code> to build pristine firmwares:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>client.py<span class="w"> </span>--can<span class="w"> </span>can0<span class="w"> </span>--upgrade<span class="w"> </span>--count<span class="w"> </span><span class="m">3</span><span class="w"> </span>--board<span class="w"> </span>ardep@1<span class="w"> </span>--pristine
</pre></div>
</div>
<p>The client script will first optionally build the firmwares, then discover all connected UDS clients and optionally upgrade them. Then it will setup the signature CAN ID chain and run the controller routine on one of the clients. Finally, it checks that the signature bytes are correct.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">ARDEP</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bootloader/index.html">Bootloader</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../firmware_loader/index.html">UDS Firmware Loader</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../console/index.html">Console Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../error_handling/index.html">Error Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../README.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../lib/index.html">Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scripts/ardep.html">ARDEP Command</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../boards/mercedes/ardep/doc/index.html">ARDEP Board</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../boards/shields/hv_shield/doc/index.html">ARDEP HV Shield</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../boards/shields/power_io_shield/doc/index.html">ARDEP Power IO Shield</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Samples and Demos</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../adc/README.html">ADC Sample</a></li>
<li class="toctree-l2"><a class="reference internal" href="../can/README.html">CAN sample</a></li>
<li class="toctree-l2"><a class="reference internal" href="../can_usb_bridge/README.html">CAN USB Bridge sample</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config_jumpers/README.html">Config Jumpers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dac/README.html">DAC sample</a></li>
<li class="toctree-l2"><a class="reference internal" href="../digital_input_interrupt/README.html">Digital Input Interrupt Sample</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gpio_expander/README.html">GPIO Expander</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hardware_test/README.html">Hardware Test Sample</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hardware_tester/README.html">Hardware Tester Sample</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hv_shield/README.html">HV Shield</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iso14229/README.html">ISO14229 Sample</a></li>
<li class="toctree-l2"><a class="reference internal" href="../led/README.html">LED Sample</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lin/lin.html">Lin Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lin2can/lin2can.html">Lin2Can Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../power_io_shield/index.html">Power IO Shield Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../uart/README.html">UART Sample</a></li>
<li class="toctree-l2"><a class="reference internal" href="../uds/README.html">UDS Sample</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">UDS Bus Sample</a></li>
<li class="toctree-l2"><a class="reference internal" href="../uds_legacy/README.html">UDS Sample (Legacy)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../debugging/index.html">Debugging</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Samples and Demos</a><ul>
      <li>Previous: <a href="../uds/README.html" title="previous chapter">UDS Sample</a></li>
      <li>Next: <a href="../uds_legacy/README.html" title="next chapter">UDS Sample (Legacy)</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Frickly Systems GmbH.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 6.2.1</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../../_sources/samples/uds_bus_sample/README.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>